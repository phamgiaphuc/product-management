<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background-color: #f4f6f9;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* Stats Cards Grid */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .card h3 {
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 10px;
      }
      .card .value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #2c3e50;
      }
      .card.alert {
        border-left: 5px solid #dc3545;
      }

      /* Dashboard Sections */
      .dashboard-row {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }
      .section {
        flex: 1;
        background: white;
        padding: 20px;
        border-radius: 10px;
        min-width: 300px;
      }
      .section h2 {
        font-size: 1.2rem;
        margin-bottom: 15px;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        padding: 10px;
        text-align: left;
        border-bottom: 1px solid #eee;
      }
      .badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        background: #dc3545;
        color: white;
      }

      /* Navigation Button */
      .btn {
        padding: 8px 16px;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 5px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üìä Executive Dashboard</h1>
        <a th:href="@{/products}" class="btn">View All Products</a>
      </div>

      <div class="stats-grid">
        <div class="card">
          <h3>Total Products</h3>
          <div class="value" th:text="${totalCount}">0</div>
        </div>
        <div class="card">
          <h3>Total Inventory Value</h3>
          <div class="value" th:text="'$' + ${#numbers.formatDecimal(totalValue, 1, 2)}">$0.00</div>
        </div>
        <div class="card">
          <h3>Avg. Price</h3>
          <div class="value" th:text="'$' + ${#numbers.formatDecimal(avgPrice, 1, 2)}">$0.00</div>
        </div>
        <div class="card alert">
          <h3>Low Stock Items</h3>
          <div class="value" th:text="${lowStockProducts.size()}">0</div>
        </div>
      </div>

      <div class="dashboard-row">
        <div class="section">
          <h2>Inventory by Category</h2>
          <div style="height: 250px; display: flex; justify-content: center">
            <canvas id="categoryChart"></canvas>
          </div>
          <ul style="margin-top: 20px; color: #666; font-size: 0.9rem">
            <li th:each="entry : ${categoryStats}">
              <span th:text="${entry.key}">Cat</span>:
              <strong th:text="${entry.value}">0</strong>
            </li>
          </ul>
        </div>

        <div class="section">
          <h2>‚ö†Ô∏è Low Stock Alerts (< 10)</h2>
          <table>
            <thead>
              <tr>
                <th>Product</th>
                <th>Qty</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="product : ${lowStockProducts}">
                <td th:text="${product.name}">Name</td>
                <td><span class="badge" th:text="${product.quantity}">5</span></td>
                <td><a th:href="@{/products/edit/{id}(id=${product.id})}">Restock</a></td>
              </tr>
              <tr th:if="${lowStockProducts.empty}">
                <td colspan="3" style="text-align: center; color: #888">Inventory healthy!</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="section">
        <h2>üïí Recently Added Products</h2>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Price</th>
              <th>Category</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="product : ${recentProducts}">
              <td th:text="${product.id}">#</td>
              <td th:text="${product.name}">Name</td>
              <td th:text="'$' + ${product.price}">$0</td>
              <td th:text="${product.category}">Cat</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script th:inline="javascript">
      var stats = {};

      var labels = Object.keys(stats);
      var data = Object.values(stats);

      var ctx = document.getElementById("categoryChart").getContext("2d");
      var myChart = new Chart(ctx, {
        type: "doughnut",
        data: {
          labels: labels,
          datasets: [
            {
              data: data,
              backgroundColor: ["#4e73df", "#1cc88a", "#36b9cc", "#f6c23e", "#e74a3b", "#858796"],
            },
          ],
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
        },
      });
    </script>
  </body>
</html>
